<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h4>functional programming</h4>
    <h5>open console mode</h5>
<script>

let users  = [
    {id:1, name:'ID', age:36},
    {id:2, name:'BJ', age:32},
    {id:3, name:'JM', age:32},
    {id:4, name:'PJ', age:27},
    {id:5, name:'HA', age:25},
    {id:6, name:'JE', age:26},
    {id:7, name:'JI', age:31},
    {id:8, name:'MP', age:23}
];


// 1. 명령형 코드
    // 1.1 age가 30 이상인 users를 거른다.
    let temp_users = [];
    for (var i = 0; i < users.length; i++) {
        if (users[i].age >= 30) {
            temp_users.push(users[i]);
        }
    }
    console.log(`명령형으로 추출(age >= 30) users: `, temp_users);
    
    // 1.2 age가 30 이상인 user의 name을 수집한다.
    let temp_users_names = [];
    for (var i = 0; i < users.length; i++) {
        if (users[i].age >= 30) {
            temp_users_names.push(users[i].name);
        }
    }
    console.log(`명령형으로 추출(age >= 30) names: `, temp_users_names);

    console.clear();

// 2. _filter, _map으로 리팩토링
    // 2.1 _filter
    function _filter(list, predfn) {
        var new_list = [];
        _each(list, function(val) {
            if (predfn(val)) {
                new_list.push(val);
            }
        });

        return new_list;
    }
    
    // 2.2 _map
    function _map(list, mapperfn) {
        var new_list = [];
        _each(list, function(val) {
            new_list.push(mapperfn(val))
        });

        return new_list;
    }
    
    // 2.3 _each
    function _each(list, iterfn) {
        for (var i = 0; i < list.length; i++) {
            iterfn(list[i]);
        }
        return list;
    };

    // --------------------- func test --------------------- //

    console.log(
        `_filter fn age >= 30`,
        _filter(users, function(user) {
            return user.age >= 30
        })
    );


    var age30over = _filter(users, function(user) {
        return user.age >= 30
    });

    console.log(
        `age >= 30 names:`,
        _map(age30over, function(user) {
            return user.name;
        })
    );
    
    console.log(
        `_map fn: `,
        _map(
            _filter(users, function(user) {
                return user.age >= 30;
            }),
            function(user) {
                return user.name;
            }
        )
    );

// 3. _curry, _curryr
    // 3.1 _curry
    function _curry(fn) {
        return function(a, b) {
            return arguments.length == 2 ? 
                fn(a, b) :
                function(b) {
                    return fn(a, b);
                }
        }
    };
        
    // 3.2 _curryr
    function _curryr(fn) {
        return function(a, b) {
            return arguments.length == 2 ? 
                fn(a, b) :
                function(b) {
                    return fn(b, a);
                }
        }
    }

    // 3.3 _get
    function _get(obj, key) {
        return obj == null ? undefined : obj[key];
    }

    // --------------------- func test --------------------- //

    var add = _curry(function(a, b) {
        return a + b;
    });

    console.log( add(20, 5) );

    var sub = _curryr(function(a, b) {
        return a - b;
    });

    var add10 = add(10);
    console.log( add10(5) );
    console.log( add(10, 30) );

    var sub10 = sub(10);
    console.log( sub10(5) );
    console.log( sub(100, 10) );
</script>
</body>
</html>